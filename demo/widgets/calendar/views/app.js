define(["sandbox","./event","../models/event","text!../templates/base.html"],function(e,t,n,r){"use strict";var i=e.mvc.View({baseTemplate:e.template.parse(r),initialize:function(){this.$el.html(r),this.calendar=this.$(".content"),e.events.bindAll(this),this.collection.bind("reset",this.addAll),this.collection.bind("event-added",this.addOne),this.collection.bind("event-modified",this.change),this.collection.bind("destroy",this.destroy),this.eventView=new t({el:this.$("#event-dialog-form")}),this.eventView.collection=this.collection,e.on("calendar",this.calendarController,this)},calendarController:function(){var e=arguments,t=e[0];if(t==="gotoDate"){e[3]!=null?this.calendar.fullCalendar("changeView","agendaDay"):this.calendar.fullCalendar("changeView","month");var n=new Date,r=e[1]||n.getYear(),i=e[2]-1||n.getMonth(),s=e[3]||n.getDay(),o=new Date(r,i,s);this.calendar.fullCalendar.call(this.calendar,"gotoDate",o)}else this.calendar.fullCalendar("changeView",e[1])},render:function(){this.calendar.fullCalendar({header:{left:"prev,next today",center:"title",right:"month,basicWeek,basicDay"},selectable:!0,selectHelper:!0,editable:!0,ignoreTimezone:!1,select:this.select,eventClick:this.eventClick,eventDrop:this.eventDropOrResize,eventResize:this.eventDropOrResize}),window.calendar=this.calendar},addAll:function(){this.calendar.fullCalendar("addEventSource",this.collection.toJSON())},addOne:function(t){this.calendar.fullCalendar("renderEvent",t.toJSON()),e.emit("new-event",t.toJSON())},select:function(e,t){this.eventView.model=new n({start:e,end:t}),this.eventView.render()},eventClick:function(e){this.eventView.model=this.collection.get(e.id),this.eventView.render()},change:function(e){var t=this.calendar.fullCalendar("clientEvents",e.get("id"))[0];t.title=e.get("title"),t.color=e.get("color"),this.calendar.fullCalendar("updateEvent",t)},eventDropOrResize:function(e){this.collection.get(e.id).save({start:e.start,end:e.end})},destroy:function(e){this.calendar.fullCalendar("removeEvents",e.id)}});return i});