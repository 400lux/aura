define(["sandbox","../collections/todos","./todos","text!../templates/base.html","text!../templates/stats.html","i18n!../../../nls/todos"],function(e,t,n,r,i,s){"use strict";var o=e.mvc.View({baseTemplate:e.template.parse(r),statsTemplate:e.template.parse(i),events:{"keypress #new-todo":"createOnEnter","click #clear-completed":"clearCompleted","click #toggle-all":"toggleComplete"},initialize:function(){this.$el.html(this.baseTemplate(s)),this.input=this.$("#new-todo"),this.allCheckbox=this.$("#toggle-all")[0],t.bind("add",this.addOne,this),t.bind("reset",this.addAll,this),t.bind("all",this.render,this),e.on("new-event",this.addEvent),e.on("todos",this.todoController,this),t.fetch()},todoController:function(){var e=arguments[0];e==="filter"?this.toggleItemsComplete(arguments[1],!1):e==="select"?this.toggleItemsComplete(arguments[1],!0):e==="checkAll"?this.toggleComplete(!0):e==="uncheckAll"&&this.toggleComplete(!1)},toggleItemsComplete:function(e,n){n||t.each(function(e){e.save({completed:!1})}),t.chain().filter(function(t){return t.get("title")===e}).each(function(e){e.save({completed:!0})})},addEvent:function(e){t.create({title:e.title,order:t.nextOrder(),completed:!1})},render:function(){var e=t.completed().length,n=t.remaining().length;this.$("#footer").html(this.statsTemplate({total:t.length,completed:e,remaining:n,clear:s.clear,completedSingular:s.completedSingular,completedPlural:s.completedPlural,itemsLeft:s.itemsLeft,itemSingular:s.itemSingular,itemPlural:s.itemPlural})),this.allCheckbox.checked=!n},addOne:function(e){var t=new n({model:e});this.$("#todo-list").append(t.render().el)},addAll:function(){t.each(this.addOne.bind(this))},newAttributes:function(){return{title:this.input.val(),order:t.nextOrder(),completed:!1}},createOnEnter:function(e){if(e.keyCode!==13)return;if(!this.input.val())return;t.create(this.newAttributes()),this.input.val("")},clearCompleted:function(){return e.util.each(t.completed(),function(e,t){t.clear()}),!1},toggleComplete:function(e){var n=$.type(e)==="boolean"?e:this.allCheckbox.checked;t.each(function(e){e.save({completed:n})})}});return o});